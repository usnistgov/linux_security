id: pwpolicy_pw_minclass_set
title: "Ensure PAM Enforces Password Requirements - Minimum Different Categories"
discussion: |
  The pam_pwquality module's minclass parameter controls requirements for usage of different character classes, or types, of character that must exist in a password before it is considered valid. For example, setting this value to three (3) requires that any password must have characters from at least three different categories in order to be approved. The default value is zero (0), meaning there are no required classes. There are four categories available: Upper-case characters, Lower-case characters, Digits, and Special characters (for example, punctuation). Modify the minclass setting in /etc/security/pwquality.conf entry to require 4 differing categories of characters when changing passwords.
check: |
  $OS_VALUE
result:
  integer: 1
fix: |
  $OS_VALUE
references:
  cce:
    - $OS_VALUE
  cci:
    - CCI-000195
  800-53r5:
    - CM-6(a)
    - IA-5(c)
    - IA-5(1)(a)
    - IA-5(4) 
  srg:
    - SRG-OS-000072-GPOS-00040
  disa_stig:
    - $OS_VALUE
tags:
  - 800-53r5_moderate
  - 800-53r5_high
  - client
  - server
severity: "medium"
os_specifics:
  ubuntu:
    '2004':
      references:
        cce:
          - N/A
        disa_stig:
          - 
        check: |
          echo "Check This"
        fix: |
          [source,bash]
          ---
          # Remediation is applicable only in certain platforms
          if dpkg-query --show --showformat='${db:Status-Status}\n' 'libpam-runtime' 2>/dev/null | grep -q installed; then

          var_password_pam_minclass='4'

          # Strip any search characters in the key arg so that the key can be replaced without
          # adding any search characters to the config file.
          stripped_key=$(sed 's/[\^=\$,;+]*//g' <<< "^minclass")

          # shellcheck disable=SC2059
          printf -v formatted_output "%s = %s" "$stripped_key" "$var_password_pam_minclass"

          # If the key exists, change it. Otherwise, add it to the config_file.
          # We search for the key string followed by a word boundary (matched by \>),
          # so if we search for 'setting', 'setting2' won't match.
          if LC_ALL=C grep -q -m 1 -i -e "^minclass\\>" "/etc/security/pwquality.conf"; then
              escaped_formatted_output=$(sed -e 's|/|\\/|g' <<< "$formatted_output")
              LC_ALL=C sed -i --follow-symlinks "s/^minclass\\>.*/$escaped_formatted_output/gi" "/etc/security/pwquality.conf"
          else
              if [[ -s "/etc/security/pwquality.conf" ]] && [[ -n "$(tail -c 1 -- "/etc/security/pwquality.conf" || true)" ]]; then
                  LC_ALL=C sed -i --follow-symlinks '$a'\\ "/etc/security/pwquality.conf"
              fi
              printf '%s\n' "$formatted_output" >> "/etc/security/pwquality.conf"
          fi

          else
              >&2 echo 'Remediation is not applicable, nothing was done'
          fi
          ---
    '2204':
      references:
        cce:
          - N/A
        check: |
          echo "Check This"
        fix: |
          [source,bash]
          ---
          # Remediation is applicable only in certain platforms
          if dpkg-query --show --showformat='${db:Status-Status}\n' 'libpam-runtime' 2>/dev/null | grep -q installed; then

          var_password_pam_minclass='4'

          # Strip any search characters in the key arg so that the key can be replaced without
          # adding any search characters to the config file.
          stripped_key=$(sed 's/[\^=\$,;+]*//g' <<< "^minclass")

          # shellcheck disable=SC2059
          printf -v formatted_output "%s = %s" "$stripped_key" "$var_password_pam_minclass"

          # If the key exists, change it. Otherwise, add it to the config_file.
          # We search for the key string followed by a word boundary (matched by \>),
          # so if we search for 'setting', 'setting2' won't match.
          if LC_ALL=C grep -q -m 1 -i -e "^minclass\\>" "/etc/security/pwquality.conf"; then
              escaped_formatted_output=$(sed -e 's|/|\\/|g' <<< "$formatted_output")
              LC_ALL=C sed -i --follow-symlinks "s/^minclass\\>.*/$escaped_formatted_output/gi" "/etc/security/pwquality.conf"
          else
              if [[ -s "/etc/security/pwquality.conf" ]] && [[ -n "$(tail -c 1 -- "/etc/security/pwquality.conf" || true)" ]]; then
                  LC_ALL=C sed -i --follow-symlinks '$a'\\ "/etc/security/pwquality.conf"
              fi
              printf '%s\n' "$formatted_output" >> "/etc/security/pwquality.conf"
          fi

          else
              >&2 echo 'Remediation is not applicable, nothing was done'
          fi
          ---
